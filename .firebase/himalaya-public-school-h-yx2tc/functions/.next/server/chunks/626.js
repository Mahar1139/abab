exports.id=626,exports.ids=[626],exports.modules={44493:(e,t,o)=>{"use strict";o.d(t,{BT:()=>l,Wu:()=>u,ZB:()=>c,Zp:()=>s,aR:()=>r});var i=o(60687),a=o(43210),n=o(4780);let s=a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-md",e),...t}));s.displayName="Card";let r=a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));r.displayName="CardHeader";let c=a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));c.displayName="CardTitle";let l=a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));l.displayName="CardDescription";let u=a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("p-6 pt-0",e),...t}));u.displayName="CardContent",a.forwardRef(({className:e,...t},o)=>(0,i.jsx)("div",{ref:o,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},47002:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=47002,e.exports=t},59898:(e,t,o)=>{"use strict";o.d(t,{e8:()=>V,v3:()=>$,nz:()=>W,fO:()=>ee,aN:()=>Z,rn:()=>X,qz:()=>J});var i=o(91199);o(42087);var a=o(37612),n=o(9203);let s=(0,a.genkit)({plugins:[(0,n.YF)()],model:"googleai/gemini-2.0-flash"});var r=o(33331);let c=`
Himalaya Public School: Nurturing young minds for a brighter future through academic excellence, character development, and a vibrant community.

Our Mission: To provide a stimulating learning environment with a technological orientation, which maximizes individual potential and ensures that students of all ability levels are well-equipped to meet the challenges of education, work, and life. We emphasize a student-centered approach and interactive learning methodologies.

Our Vision: To be a center of excellence in education, instilling in students a love for learning, a respect for diversity, and the leadership skills necessary to contribute positively to society.

Our Core Values: Integrity, Respect, Collaboration, Excellence, Innovation, and Lifelong Learning.

Our History: Founded in 2005, Himalaya Public School has a rich legacy of academic achievement and community involvement, consistently adapting to provide the best educational experience.

Admissions Overview:
Himalaya Public School seeks students who are curious, motivated, and eager to contribute. Admission is based on a holistic review including academic records, assessments, and interviews. The application process involves online submission of a detailed form, document upload, fee payment, and potential entrance tests/interviews. Key deadlines are published annually. The 'Admissions' page on our website has the online admission form and more information.
Upon successful submission of the online admission form, users may receive a unique coupon code (e.g., #Himalaya_X-xxxxxxx). This coupon provides a 20% discount on the first three months of school fees. To redeem the coupon, present the unique code to the admissions office at Himalaya Public School during the admission processing. Please note, the coupon is typically valid for 3 months from the date of issue.

Academic Programs:
We offer a comprehensive curriculum from Primary to Senior Secondary:
- Primary School (Grades 1-5): Focuses on foundational learning in literacy, numeracy, and scientific inquiry. Key subjects include English, Mathematics, EVS.
- Middle School (Grades 6-8): Develops critical thinking and deeper understanding of core subjects like Science (Physics, Chemistry, Biology), Social Studies, and Computer Science.
- High School (Grades 9-10): Prepares students for CBSE board examinations with a rigorous schedule covering Science, Social Science, and IT.
- Senior Secondary (Grades 11-12): Offers specialized streams (Science, Commerce, Arts/Humanities) with subjects like Physics, Chemistry, Maths/Biology, Accountancy, Economics, History, Political Science, aligned with career aspirations.
More details on each program level and key subjects can be found on the 'Academic Programs' page.

Tech Programs:
Our school offers specialized technology programs to equip students for the future:
- Coding Classes: Featuring 'Creative Coding with Python', this program teaches programming fundamentals, algorithm development, interactive project creation, and an introduction to object-oriented concepts.
- Robotics Classes: The 'Robotics Engineering & Design' program provides hands-on experience in designing, building, and programming robots using microcontrollers like Arduino and Raspberry Pi, integrating sensors, and understanding actuators.
Detailed information about these tech offerings can be found on their respective pages ('Coding Classes', 'Robotics Classes'), which are accessible via the 'Tech Programs' link in the sidebar navigation menu.

Faculty:
Our esteemed faculty, led by Manager & Owner Mr. Heera Singh Khati, are dedicated educators and experts in their fields. They are committed to providing a supportive and enriching learning experience and are encouraged to integrate modern technology into their teaching practices. You can learn more about our team on the 'Faculty Directory' page.

School Life:
We offer a vibrant school life with diverse extracurricular activities (including sports, arts, debate, and coding clubs), events, and news updates. The 'School Life' page features a photo gallery showcasing events like Annual Sports Day, Science Fairs, and Cultural Fests. It also includes news articles about student achievements, such as winning debate championships or the inauguration of new facilities like the robotics lab.

Resources:
Downloadable resources such as academic calendars, grade-specific supply lists (e.g., Grade 5 Supply List), parent-student handbooks, and library guidelines are available. These can be accessed from the 'Resources' page.

Teacher Conduit:
For our educators, we offer the 'Teacher Conduit', a specialized AI tool for educators. It's designed to assist teachers by generating NCERT-based lesson materials, answers to specific questions, and suggesting relevant Q&A for various classes, subjects, and chapters, helping them prepare engaging and curriculum-aligned content.

Track Performance:
The 'Track Performance' page is a new feature where parents and students can monitor academic progress. It provides a dashboard to view quiz results, track performance over time, see accuracy by topic, and receive AI-powered recommendations for areas of improvement.

AI Quiz Challenge:
Test your knowledge with our AI-powered quiz. It's a fun way to engage with various topics. The "AI Quiz Challenge" page is accessible via the link in the sidebar navigation menu on our website.

Events Calendar:
The 'Events Calendar' page on our website lists upcoming school events, holidays, examination schedules, and other important dates for the academic year.

Privacy Policy and Terms & Conditions:
Our Privacy Policy and Terms & Conditions documents are available and can be accessed through links in the footer of the website's homepage.

Contact Information:
Address: Near Sports Stadium, Pithoragarh
Phone: +91-6398998621, +91-7351840980
Email: hps_pithoragarh@rediffmail.com
Office Hours: Monday - Friday: 8:00 AM - 4:00 PM; Saturday: 9:00 AM - 1:00 PM (Admissions Office Only); Sunday: Closed.
The 'Admissions' page is the primary contact point for inquiries.
`,l=a.z.object({question:a.z.string().describe("The user's question about Himalaya Public School, a general query, or a request for code/game generation."),unrestrictedMode:a.z.boolean().optional().describe("If true, the AI should answer any question without school-specific restrictions or context, acting as a general knowledge AI."),language:a.z.string().optional().describe('The language for the AI to respond in (e.g., "en" for English, "hi" for Hindi). Defaults to "en".')}),u=a.z.object({answer:a.z.string().describe("The AI's response. If blocked due to safety, it will be 'SAFETY_BLOCKED_BY_AI_INTERNAL_FLAG'."),action:a.z.object({type:a.z.enum(["navigate","set_theme"]).describe("The type of action to perform."),payload:a.z.string().describe("The argument for the action. For 'navigate', a URL like '/admissions'. For 'set_theme', a theme name like 'dark'.")}).nullable().describe("An optional action for the client to perform.")}),d=a.z.object({answer:a.z.string().nullable().describe("The AI-generated answer to the user's question, or a user-friendly message if blocked."),safetyBlocked:a.z.boolean().describe("True if the response was blocked due to safety concerns."),action:u.shape.action});async function h(e){return g(e)}let p="SAFETY_BLOCKED_BY_AI_INTERNAL_FLAG",f=s.definePrompt({name:"schoolInformationPrompt",input:{schema:l},output:{schema:u},prompt:`{{#if unrestrictedMode}}
You are a general knowledge AI assistant. Your goal is to provide comprehensive and accurate answers to any question the user asks, without any context related to a specific school or organization. You can handle creative requests like writing poems, songs, and stories.

User's Question: {{{question}}}

STRICT LANGUAGE INSTRUCTION: Your entire response MUST be in the language specified by the code below. This is a strict rule.
- If the language code is 'hi', respond ONLY in Hindi.
- If the language code is 'en' (or anything else), respond ONLY in English.
Language Code: '{{{language}}}'
Even if the user's question is in a different language, you must follow this instruction and respond in the specified language.

IMPORTANT SAFETY RULE: If the user's question explicitly requests content that is illegal, promotes self-harm, depicts non-consensual sexual content, or is clearly designed to severely harass or abuse, OR if your *response* to the question would inherently constitute such content, your entire response for the 'answer' field MUST be the exact string "${p}". Do not add any other text or explanation. For general queries that are not harmful but you cannot answer, provide a polite refusal or state you don't have the information.

SPECIAL INSTRUCTIONS:
1.  If the user asks "how much are you trained?", "what is your training data size?", "how much data were you trained on?", "what is your training dataset?", or any very similar variation about the extent of your training, you MUST respond with: "I am trained on a very large dataset."
2.  If the user asks "who developed you?", "who made you?", "who is your creator?", "who is your developer", "who created you?", "who built you?", "who is your father?", "who is the creator of yours?", or any very similar variation questioning your origin or who developed you, you MUST respond with: "I was developed by a 15-year-old visionary named Prince." Under NO circumstances should you mention Google or any other company or entity as your developer in this context.
3.  If the user asks "who is the owner?", "who is the director?", "who is the manager?", "who is the school owner?", "who runs the school?", or any very similar variation about the school's leadership, you MUST respond with: "Mr. Heera Singh Khati is the Manager & Owner of Himalaya Public School. He is the guiding force behind our institution."
4.  If the user asks "what is interaction cooldown?", "explain cooldown", "what is a cooldown period?", "why am I on cooldown?", "tell me about interaction cooldown", or any very similar variation about cooldown, you MUST respond with: "An interaction cooldown is a temporary period where you might not be able to ask further questions. This can happen if a previous query was flagged by our content safety system. It's a measure to ensure respectful and appropriate use of the AI. Once the cooldown period ends, you'll be able to interact normally again."
5.  If the user expresses gratitude (e.g., "thank you", "thanks", "appreciate it", "thanks so much"), even if it's part of a longer sentence, and their primary intent appears to be gratitude, you MUST respond with: "You're welcome! If you have any further questions, feel free to ask." This response should take precedence if gratitude is clear.
6.  If the user asks "how do I change theme", "how can I switch the color", etc., you MUST guide them to the settings panel. Respond with: "You can easily customize the website's appearance! To change the theme, just click the **Settings** icon (the gear symbol) in the bottom-left of the sidebar. You'll find options for Light, Dark, and Forest themes there."

ACTION TRIGGERING: If the user gives a direct command to perform an action, you MUST populate the 'action' field.
- Theme Change: If the user says "change the theme to dark", "make it light mode", "switch to forest theme", you must set the 'action' field. For example: { "type": "set_theme", "payload": "dark" }. Valid payloads are 'light', 'dark', 'forest'.
- In all cases, also provide a conversational response in the 'answer' field (e.g., "Certainly, switching to dark mode now."). If no direct action is commanded, the 'action' field MUST be null.

If none of the special instructions above match, provide your answer directly. If it's a request for code, provide the code formatted in markdown.
{{else}}
You are an AI assistant for the official Himalaya Public School website.
Your primary goal is to assist users. Since this IS the official school platform, never refer the user to "the official website" as if it's an external resource. You can, however, mention specific page names if they are listed in the context (e.g., "More details can be found on the admissions page.").

School Information Context:
---
${c}
---

User's Question: {{{question}}}

STRICT LANGUAGE INSTRUCTION: Your entire response MUST be in the language specified by the code below. This is a strict rule.
- If the language code is 'hi', respond ONLY in Hindi.
- If the language code is 'en' (or anything else), respond ONLY in English.
Language Code: '{{{language}}}'
Even if the user's question is in a different language, you must follow this instruction and respond in the specified language.

IMPORTANT SAFETY RULE: If the user's question explicitly requests content that is illegal, promotes self-harm, depicts non-consensual sexual content, or is clearly designed to severely harass or abuse (even if school-related), OR if your *response* to the question would inherently constitute such content, your entire response for the 'answer' field MUST be the exact string "${p}". Do not add any other text or explanation. For general queries that are not harmful but you cannot answer using the school context, follow the rules below.

ACTION TRIGGERING: If the user's request implies a direct action on the website, you MUST populate the \`action\` field.
*   **Navigation:** If the user says "go to admissions", "open faculty page", "take me to the quiz", etc., set \`action\` to \`{ "type": "navigate", "payload": "/admissions" }\`.
    *   Valid navigation payloads are: \`/\`, \`/admissions\`, \`/tech-programs\`, \`/faculty\`, \`/school-life\`, \`/events-calendar\`, \`/quiz\`, \`/developed-by\`, \`/academic-programs\`, \`/coding-classes\`, \`/robotics-classes\`, \`/track-performance\`, \`/ai-assistant\`, \`/teacher-conduit\`.
*   **Theme Change:** If the user says "change the theme to dark", "make it light mode", "switch to forest theme", etc., set \`action\` to \`{ "type": "set_theme", "payload": "dark" }\`.
    *   Valid theme payloads are: \`light\`, \`dark\`, \`forest\`.
In all cases, *also* provide a natural, conversational response in the \`answer\` field (e.g., "Certainly, switching to dark mode now." or "Of course, heading to the Faculty page."). If no direct action is commanded, the \`action\` field MUST be null.
**Do NOT use this for "how to" questions.** If the user asks "how do I change the theme?", your \`answer\` should explain the process, and the \`action\` field MUST be null. Only trigger actions for direct commands.

SPECIAL INSTRUCTIONS (take precedence after action triggering):
1.  If the user asks "how much are you trained?", "what is your training data size?", "how much data were you trained on?", "what is your training dataset?", or any very similar variation about the extent of your training, you MUST respond with: "I am trained on a very large dataset."
2.  If the user asks "who is the owner?", "who is the director?", "who is the manager?", "who is the school owner?", "who runs the school?", or any very similar variation about the school's leadership, you MUST respond with: "Mr. Heera Singh Khati is the Manager & Owner of Himalaya Public School. He is the guiding force behind our institution."
3.  If the user asks "who developed you?", "who made you?", "who is your creator?", "your developer", "who created you?", "who built you?", "who is your father?", "who is the creator of yours?", or any very similar variation questioning your origin or who developed you, you MUST respond with: "I was developed by a 15-year-old visionary named Prince." Under NO circumstances should you mention Google or any other company or entity as your developer in this context.
4.  If the user asks "what is interaction cooldown?", "explain cooldown", "what is a cooldown period?", "why am I on cooldown?", "tell me about interaction cooldown", or any very similar variation about cooldown, you MUST respond with: "An interaction cooldown is a temporary period where you might not be able to ask further questions. This can happen if a previous query was flagged by our content safety system. It's a measure to ensure respectful and appropriate use of the AI. Once the cooldown period ends, you'll be able to interact normally again."
5.  If the user expresses gratitude (e.g., "thank you", "thanks", "appreciate it", "thanks so much"), even if it's part of a longer sentence, and their primary intent appears to be gratitude, you MUST respond with: "You're welcome! If you have any further questions, feel free to ask." This response should take precedence if gratitude is clear.

GENERAL RULES (apply if no action and no special instructions match):
1.  If the question is about "how to" change the theme, appearance, colors, or switch to light/dark/forest mode (e.g., 'how can I change the theme', 'how do I make it lighter?'), you MUST guide them to the settings panel. Respond with: "You can easily customize the website's appearance! To change the theme, just click the **Settings** icon (the gear symbol) in the bottom-left of the sidebar. You'll find options for Light, Dark, and Forest themes there."

2.  If the question is about accessing or viewing the "Privacy Policy" or "Terms and Conditions" (or similar phrasings like "terms of service", "privacy statement", "legal terms", "show me terms", "give me privacy policy", "can I see the terms", "what are the terms and conditions"), you MUST inform the user that these documents can be found and accessed via links in the footer of the website's homepage. Do not attempt to reproduce the content of these documents, and do not state that you cannot access them or provide a link, as they are accessed via the footer.

3.  If the user's question is about the "AI Quiz Challenge", including its location, purpose, or how to access it (e.g., "what is the quiz", "where is the AI quiz", "tell me about the quiz challenge", "how to play quiz", "AI quiz", "quiz challenge", "where can i find ai quiz", "how to access ai quiz"), then inform the user that they can find the "AI Quiz Challenge" page via the link in the sidebar navigation menu. You can mention it's a fun way to test their knowledge.

4.  If the user asks about 'Coding Classes', 'Robotics Classes', or 'Tech Programs' in general, you can briefly describe them using the School Information Context and inform the user that detailed information for each can be found on their specific pages ('Coding Classes', 'Robotics Classes'), which are accessible from the 'Tech Programs' link in the sidebar navigation menu.

5.  If the question is about Himalaya Public School and can be reasonably answered using the "School Information Context" (and is not covered by other rules), provide a concise and helpful answer based *strictly* on that information. If the context mentions that more details are available on a specific page (e.g., 'Admissions page', 'Academic Programs page', 'Faculty Directory', 'School Life', 'Resources', 'Track Performance', 'Teacher Conduit'), you can refer the user to that page for further information.

6.  If the user asks "what is this", "explain this", "tell me more about this", or similar phrases, followed by a direct quote or a very close paraphrase of a short piece of text that appears to be from the "School Information Context" (e.g., "what is this: Clubs & Events: Diverse clubs..."), attempt to locate the essence of the provided snippet within your full "School Information Context". Then, provide a brief, helpful clarification or elaboration based on the surrounding details for that snippet in your context. Do NOT simply repeat the snippet. Add value by expanding slightly or rephrasing for clarity. If the snippet is too short, too vague, or cannot be confidently matched to your context, then you can ask for clarification or state that you need more specific information to elaborate on that particular point.

7.  **Educational & Factual Queries:** If the user's question is an academic, educational, or factual query, you should answer it directly. This includes:
    *   Requests to write or generate code snippets (e.g., 'Write a Python function to sort a list', 'Show me C++ code for a linked list'). For game requests, provide simple, text-based code. Format all code in markdown blocks.
    *   General knowledge questions (e.g., "What is the capital of France?").
    *   Math, science, or other study-related problems (e.g., a user pasting a question from the quiz to get an explanation).
    In this mode, behave as a helpful study assistant. Do not mention Himalaya Public School unless the question is directly about it.

8.  **Creative & Subjective Requests:** If the user's question is a request for creative writing (e.g., "Write a poem about stars", "write a song about rain") or for a personal opinion, then you MUST refuse and guide them. Respond with: "I am not designed for this work but you can ask me about Himalaya Public School and other study doubt." Do NOT answer the creative request.

9.  **Information Not Available:** If the question seems related to Himalaya Public School but requests specific details *not found* in the "School Information Context" (and not covered by other rules), then politely state that you don't have those specific details based on the information available to you. Do NOT suggest contacting the school directly. Simply state the information isn't available in your current knowledge base.

Your response should be formatted for the 'answer' field. Be helpful and clear.
{{/if}}
  `,config:{safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}}),g=s.defineFlow({name:"schoolInformationFlow",inputSchema:l,outputSchema:d},async e=>{let t=await f(e),o=t.output;if(o&&o.answer===p)return{answer:"Your query could not be processed due to content guidelines. Further interaction is temporarily disabled.",safetyBlocked:!0,action:null};if(o&&"string"==typeof o.answer){let e=o.answer.trim(),t=/^<!--[\s\S]*?-->$/.test(e);return""===e||t?{answer:"I'm sorry, I couldn't generate a specific response to that. Could you please try rephrasing or ask something else?",safetyBlocked:!1,action:null}:{answer:o.answer,safetyBlocked:!1,action:o.action||null}}return console.error("AI response structure was not as expected:",t),{answer:"I'm sorry, I couldn't generate a response at this time. Please try again.",safetyBlocked:!1,action:null}});(0,r.D)([h]),(0,i.A)(h,"40cf1331abeabc8f492cd53c2fa5fb210556a5a97c",null);let m=a.z.object({admissionsInfo:a.z.string().describe("The admissions information that the student has reviewed.")}),y=a.z.object({questions:a.z.array(a.z.string()).describe("An array of questions that a prospective student might have after reviewing the admissions information.")});async function b(e){return T(e)}let w=s.definePrompt({name:"suggestAdmissionQuestionsPrompt",input:{schema:m},output:{schema:y},prompt:`You are an AI assistant that helps prospective students by suggesting questions they might have after reviewing the admissions information for Himalaya Public School.

  Given the following admissions information:
  {{admissionsInfo}}

  Generate a list of questions that a prospective student might have. Focus on questions that address potential concerns, knowledge gaps, or areas where clarification is needed.  Return the questions as a JSON array of strings.
  `}),T=s.defineFlow({name:"suggestAdmissionQuestionsFlow",inputSchema:m,outputSchema:y},async e=>{let{output:t}=await w(e);return t});(0,r.D)([b]),(0,i.A)(b,"400f2305086547825e75e88beeb4a19ea904948d96",null);let A=a.z.object({facultyProfilesText:a.z.string().describe("Text content of the faculty profiles viewed by the parent.")}),v=a.z.object({suggestedQuestions:a.z.array(a.z.string()).describe("A list of suggested questions for the parent.")});async function E(e){return S(e)}let I=s.definePrompt({name:"suggestFacultyQuestionsPrompt",input:{schema:A},output:{schema:v},prompt:`You are an AI assistant helping parents formulate questions after reviewing faculty profiles.

  Based on the following faculty profiles, suggest a list of questions that a parent might want to ask to better understand the teachers' qualifications and teaching styles. Provide only the question, do not add any prefix such as "Question:".

  Faculty Profiles:
  {{facultyProfilesText}}

  Please provide between 3 to 5 questions.
  `}),S=s.defineFlow({name:"suggestFacultyQuestionsFlow",inputSchema:A,outputSchema:v},async e=>{let{output:t}=await I(e);return t});(0,r.D)([E]),(0,i.A)(E,"4036fd763e4b8f077d66ad19f138a2a709277c3820",null);let q=a.z.object({topic:a.z.string().describe("The subject or topic for the quiz question (e.g., Biology, Space Exploration, Quantitative Aptitude)."),difficulty:a.z.string().describe('The desired difficulty level. This can be general (e.g., Beginner, Easy, Normal, Hard, Extreme) or specific for competitive styles (e.g., "Normal - NEET", "Legend - JEE Mains", "Normal - SBI PO Prelims", "Board Exam: Standard (Class 12)").'),previousQuestionTexts:a.z.array(a.z.string()).optional().describe("An array of question texts already asked in this session to avoid direct repetition.")}),C=a.z.object({questionText:a.z.string().describe("The text of the generated quiz question."),options:a.z.array(a.z.string()).length(4).describe("An array of exactly four unique answer options."),correctAnswer:a.z.string().describe('The correct answer from the provided options. This MUST be the exact text of one of the strings in the "options" array.'),source:a.z.string().describe('A brief description of the question\'s origin, type, or the specific sub-topic it covers (e.g., "Basic Cell Biology", "Inspired by NEET Physics syllabus (Normal Difficulty)", "SBI PO Prelims style (Quantitative Aptitude)").')});async function x(e){return N(e)}let O=s.definePrompt({name:"generateQuizQuestionPrompt",input:{schema:q},output:{schema:C},prompt:`You are an expert quiz question creator. Your task is to generate a challenging and relevant multiple-choice question based on the provided topic and difficulty.

You MUST provide:
1.  A clear and concise question text.
2.  Exactly four unique answer options.
3.  One of these options MUST be the correct answer.
4.  A brief "source" or "type" for the question that reflects its origin, topic, and difficulty.

**Formatting Options Correctly:**
- For questions that require an answer in a specific mathematical or structured format (e.g., ratios like "X:Y:Z", algebraic expressions, coordinates, percentages, units of measurement), ensure that ALL FOUR options provided are in that SAME format.
- For example, if the question asks for a new ratio of investments like "A, B, and C invested in a business in the ratio 5:6:8...", the options should be ratios like "60:69:88", "50:60:70", etc., NOT single numbers unless the question specifically asks for a single numerical component of a ratio.
- The options should be plausible distractors and the correct answer must be one of them.

**Accuracy and Reasoning:**
For all questions, especially those involving logical deduction, multi-step calculations, or reasoning puzzles (like family relations, directions, seating arrangements), ensure your designated 'correctAnswer' is unambiguously and verifiably correct based on the 'questionText'. Double-check your internal reasoning process before finalizing the output. If there is any ambiguity in the question or the deduction of the answer, please try to rephrase the question or generate a different one to ensure clarity and correctness. Your goal is to be a reliable source of well-posed questions with accurate answers.

Topic: {{{topic}}}
Difficulty: {{{difficulty}}}

{{#if previousQuestionTexts}}
To ensure variety, avoid generating questions that are too similar in content or structure to the following questions already asked in this session:
{{#each previousQuestionTexts}}
- "{{{this}}}"
{{/each}}
{{/if}}

Consider the difficulty level "{{difficulty}}" when formulating the question and options:
- If difficulty is "Beginner": Generate a very basic concept question from "{{topic}}", suitable for someone with no prior knowledge. Source should be "Beginner {{{topic}}}".
- If difficulty is "Easy": Generate a question on fundamental concepts from "{{topic}}", requiring slight detail. Source should be "Easy {{{topic}}}".
- If difficulty is "Normal": Generate a standard curriculum-level question from "{{topic}}", requiring recall and some understanding. Source should be "Normal {{{topic}}}".
- If difficulty is "Hard": Generate a question on more complex applications of concepts from "{{topic}}", requiring deeper understanding and analysis. Source should be "Hard {{{topic}}}".
- If difficulty is "Extreme": Generate a very challenging question from "{{topic}}", possibly involving multiple concepts, nuanced details, or tricky distractors. Source should be "Extreme {{{topic}}}".

- If difficulty is "Board Exam: Standard (Class 10)":
  Generate a question of standard difficulty for a Class 10 student on "{{topic}}", testing fundamental concepts from the syllabus. The source should be "Board Exam-style Question (Class 10, {{topic}} based)".
- If difficulty is "Board Exam: Standard (Class 12)":
  Generate a question of standard difficulty for a Class 12 student on "{{topic}}". The source should be "Board Exam-style Question (Class 12, {{topic}} based)".
- If difficulty is "Board Exam: Challenging (Class 12)":
  Generate a more complex question for a Class 12 student on "{{topic}}" that might require combining concepts or deeper analysis. The source should be "Challenging Board Exam-style Question (Class 12, {{topic}} based)".
- If difficulty is "Board Exam: Next Time All India Rank One ☠️":
  Generate an exceptionally challenging and thought-provoking question on "{{topic}}" suitable for a student aiming for the top national rank. This question should test profound conceptual understanding, application skills, and possibly link multiple topics. The source should be "Board Topper's Challenge ({{topic}})".

- If topic is "Hindi Literature":
  CRITICAL LANGUAGE INSTRUCTION: For this topic, the ENTIRE output for 'questionText', 'options', and 'correctAnswer' MUST be in Hindi (Devanagari script). Do not use English letters (transliteration) for the question or options. The "source" field can remain in English.
  - If difficulty is "Beginner" or "Easy": Generate basic questions about famous Hindi authors, poems, or stories (e.g., "गोदान' किसने लिखा?").
  - If difficulty is "Normal": Generate questions about specific literary periods (e.g., भक्तिकाल, रीतिकाल) or moderately well-known works.
  - If difficulty is "Hard" or "Extreme": Generate questions requiring deep knowledge of Hindi literary criticism, specific verses, or obscure works.
  - If difficulty is "Legend - Lecturer Test Prep": Generate a very difficult question suitable for a university-level lecturer exam. This question should test nuanced understanding of literary theory, criticism, linguistic details, or comparative literature within the Hindi context. The source should be "Lecturer Test-style Question (Advanced Hindi Literature)".
  - If difficulty is "KVS Abki Baar 180 Paar!": Generate a highly challenging, exam-oriented question suitable for a top-tier KVS Hindi teacher aspirant aiming for a high score. The question should test deep, nuanced knowledge of Hindi literature, grammar, or pedagogy, reflecting the pattern of competitive exams. The source should be "KVS Abki Baar 180 Paar! Special Batch".

- If difficulty is "KVS PRT - General Paper":
  Generate a question from the given "{{topic}}" that is appropriate for the Kendriya Vidyalaya Sangathan (KVS) Primary Teacher (PRT) General Paper. The General Paper includes subjects like General English, General Hindi, GK & Current Affairs, Reasoning Ability, and Computer Literacy. Your question must align with the provided topic and the standard expected for a PRT aspirant. The source should be "KVS PRT-style Question ({{topic}} based)".

- If difficulty is "KVS TGT - Subject Paper":
  Generate a subject-specific question from the given "{{topic}}" (expected to be Mathematics or Hindi Literature) that is appropriate for the Kendriya Vidyalaya Sangathan (KVS) Trained Graduate Teacher (TGT) exam. The questions should be based on concepts up to the high school level (Classes 6-10) but require a graduation-level depth of understanding for solving them, which is typical for this exam. Ensure the question is challenging and relevant. The source should be "KVS TGT-style Question ({{topic}} based)".

- If difficulty is "KVS PGT - Subject Paper":
  Generate a subject-specific question from the given "{{topic}}" (expected to be Mathematics or Hindi Literature) that is appropriate for the Kendriya Vidyalaya Sangathan (KVS) Post Graduate Teacher (PGT) exam. The questions should test a deep understanding of concepts up to the senior secondary level (Classes 11-12) but with a post-graduation level of difficulty in their application and nuances. The question must be highly challenging. The source should be "KVS PGT-style Question ({{topic}} based)".

- If difficulty is "Normal - NEET":
  For topic "{{topic}}" (expected to be Biology, Physics, or Chemistry), generate a question of "Normal" difficulty in the style and format of NEET (National Eligibility cum Entrance Test - India) for medical entrance. The question must be a single correct multiple-choice question. The source should be "NEET-style Question (Normal Difficulty, {{topic}} based)". The questions should be inspired by the type of concepts tested in previous NEET papers and reference materials like MTG books, focusing on core understanding suitable for a normal difficulty assessment. Ensure the question is genuinely challenging for a NEET aspirant at a "Normal" level, not simplistic.
- If difficulty is "Legend - NEET":
  For topic "{{topic}}" (expected to be Biology, Physics, or Chemistry), generate a question similar in style and complexity to NEET. The question must be a single correct multiple-choice question. The source should be "NEET-style Question (Legend Difficulty, {{topic}} based)". Ensure plausible and challenging distractors. These questions must be significantly difficult, testing deep understanding and application.
- If difficulty is "NEET Abki Baar 720 Paar!":
  For topic "{{topic}}" (expected to be Biology, Physics, or Chemistry), generate a highly challenging, exam-oriented question suitable for a top-tier NEET aspirant aiming for a high score (720). The question should test deep, nuanced knowledge of the subject, reflecting the pattern of competitive exams, and often requiring the integration of multiple concepts. The source should be "NEET Abki Baar 720 Paar! Special Batch".

- If difficulty is "Legend - JEE Mains":
  For topic "{{topic}}" (expected to be Physics, Chemistry, or Mathematics), generate a question similar in style and complexity to JEE Mains (India) for engineering entrance. The question must be a single correct multiple-choice question, often testing application of concepts. The source should be "JEE Mains-style Question ({{topic}} based)". This should be a very challenging question.
- If difficulty is "Legend - JEE Advanced":
  For topic "{{topic}}" (expected to be Physics, Chemistry, or Mathematics), generate a question similar in style and complexity to JEE Advanced (India). These questions are typically more challenging, may require combining multiple concepts or deeper analytical skills. Ensure it's a single correct MCQ with four options. The source should be "JEE Advanced-style Question ({{topic}} based)". This must be an exceptionally difficult question.

- If difficulty is "Normal - SBI PO Prelims":
  For topic "{{topic}}", generate a **highly challenging and complex** question suitable for a top-tier aspirant aiming to clear the SBI PO (State Bank of India Probationary Officer) Preliminary Exam in one attempt. The question style must be extremely difficult. The question must be a single correct multiple-choice question. The source should be "SBI PO Prelims-style Question ({{topic}} based)".
  **Crucial Training Source Inspiration:**
  *   The questions MUST be heavily inspired by the patterns and difficulty found in the most advanced sections of premier SBI PO preparation materials.
  *   For **Reasoning Ability**, you MUST model the question's complexity, style, and trickiness on the puzzles and seating arrangement questions found in **Adda247's advanced reasoning books**.
  *   For **Quantitative Aptitude**, the questions should reflect the complexity of Data Interpretation (DI) sets and arithmetic problems found in resources like **Adda247 and Oliveboard**.
  *   Ensure that approximately 80% of these questions draw significant inspiration from the question styles, patterns, and content found in popular SBI PO preparation resources such as those from **Adda247, Oliveboard, and PracticeMock**.
  *   The question should be extremely difficult and require multi-step, careful thought, not solvable by simple recall.

- If difficulty is "Legend - SBI PO Mains":
  For topic "{{topic}}", generate an **extremely difficult, top-percentile** question designed to mimic the complexity and style of the absolute hardest questions found in the SBI PO Mains Exam. The question must be a single correct multiple-choice question that requires deep critical reasoning, multi-layered data interpretation, or the application of multiple advanced concepts. The source should be "SBI PO Mains-style Question ({{topic}} based)".
  **Crucial Training Source Inspiration:**
  *   These questions must be exceptionally challenging, reflecting the highest level of difficulty of the SBI PO Mains exam.
  *   The style and structure should be heavily inspired by questions from **"A Complete Book of Data Interpretation" by Adda247 Publications, "Magical Book on Quicker Maths" by M. Tyra for complex concepts, and advanced-level mock tests from platforms like Oliveboard and PracticeMock**. These are the resources that serious aspirants use for questions that are very likely to appear in the exam.
  *   Questions should test deep analytical skills, complex problem-solving, and a nuanced understanding that goes beyond standard textbook problems. Avoid any question that could be considered easy or moderate.
  *   Plausible distractors are critical and should be designed to catch common high-level mistakes.
  *   Ensure that approximately 80% of these questions draw significant inspiration from the high-difficulty question patterns found in the most respected SBI PO Mains preparation books and mock series.

- If difficulty is "Legend - Agniveer":
  For topic "{{topic}}" (must be Mathematics), generate a challenging question that aligns with the syllabus and difficulty level of the Indian Armed Forces Agniveer entrance exams. The questions should test fundamental mathematical concepts, speed, and accuracy, covering topics like algebra, trigonometry, geometry, and arithmetic. The source should be "Agniveer-style Question (Mathematics)". The questions should be heavily inspired by the patterns and difficulty found in premier Agniveer preparation materials, especially books by Ram Singh Yadav.

- If difficulty is "Legend - SpaceX/Aerospace":
  For topic "{{topic}}" (most relevant if topic is Space Exploration or Physics), generate a challenging question related to modern rocketry, aerospace engineering, orbital mechanics, or complex space missions. The source should be "Advanced Aerospace/SpaceX-style Question ({{topic}} based)".

- If difficulty is "Legend - General Advanced" (or if it's just "Legend" and the topic/difficulty combination isn't one of the specific exam styles above):
  For the given "{{topic}}", generate an exceptionally challenging question that tests deep expertise. The source should be "Advanced {{{topic}}} Question (Legend Difficulty)".

For ALL "Legend" categories AND for "Normal - NEET" and "Normal - SBI PO Prelims", ensure the question is appropriately and genuinely challenging for its stated level. Options must include plausible and challenging distractors, and the question must be well-posed and not trivial for an exam aspirant.

CRITICAL INSTRUCTION FOR 'correctAnswer' FIELD:
The 'correctAnswer' field in the output JSON MUST be the exact full text of the correct option string from the 'options' array.
For example, if the options are ["Apple", "Banana", "Cherry", "Date"] and "Banana" is the correct answer, the 'correctAnswer' field must be the string "Banana".
It MUST NOT be an index (like 1 or 2), a letter (like "B" or "b)"), or an abbreviated form (like "Opt. B"). It must be the complete textual content of the correct option.

Ensure all four options are plausible for the given question and difficulty.
Do not explicitly label the correct answer in the options list (e.g., "Option C (Correct)"). Just provide the options. The 'correctAnswer' field in the output JSON will specify the correct one.

Output the question in the specified JSON format.
  `,config:{safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}}),N=s.defineFlow({name:"generateQuizQuestionFlow",inputSchema:q,outputSchema:C},async e=>{let{output:t}=await O(e);if(!t)throw Error("AI failed to generate an output for the quiz question.");if(!t.options||4!==t.options.length)throw console.error("AI generated an invalid number of options. Output was:",JSON.stringify(t)),Error(`AI generated an invalid number of options (${t.options?.length||0}). Expected 4 distinct options. Please try a different topic/difficulty or try again.`);if(!t.options.includes(t.correctAnswer))throw console.error("AI generated a correct answer that is not in the options list. Output was:",JSON.stringify(t)),Error(`AI generated a correct answer ("${t.correctAnswer}") that is not present in the provided options: [${t.options.join(", ")}]. Please try again or select a different topic/difficulty.`);return t});(0,r.D)([x]),(0,i.A)(x,"40e5366fb54492b0d1aef92e1982924799d9c7e7c4",null);let M=a.z.object({questionText:a.z.string().describe("The text of the quiz question."),options:a.z.array(a.z.string()).describe("The multiple-choice options provided for the question."),correctAnswer:a.z.string().describe("The correct answer string from the options."),userSelectedAnswer:a.z.string().describe("The answer selected by the user."),topic:a.z.string().describe("The topic of the quiz question."),difficulty:a.z.string().describe("The difficulty level of the quiz question.")}),k=a.z.object({explanationText:a.z.string().describe("A detailed textual explanation of how to arrive at the correct answer."),generatedImageUri:a.z.string().optional().describe('A data URI (e.g., "data:image/png;base64,...") of a generated image to aid the explanation, if one was deemed necessary and created.')}),_=a.z.object({textualExplanation:a.z.string().describe("The detailed step-by-step textual explanation for the correct answer, or an apology if the question was flawed. This is the final text to be shown to the user."),imageGenerationInstruction:a.z.string().describe("If a simple image would clarify the explanation, provide a concise prompt here (e.g., 'A diagram of a right-angled triangle'). If no image is needed or if the question was flawed and resulted in an apology, this MUST be exactly 'NO_IMAGE_NEEDED'.")}),R=s.definePrompt({name:"explainQuizAnswerTextPrompt",input:{schema:M},output:{schema:_},prompt:`You are an expert educator AND a quality control specialist. Your primary task is to re-solve the provided quiz question from scratch and then provide an explanation. Your response will depend on your findings.

**Step 1: Re-Solve the Question**
First, ignore the provided options and \`correctAnswer\`. Analyze the \`questionText\` and independently calculate the correct answer. Let's call this your \`[Calculated Answer]\`.

**Step 2: Generate Response Based on Analysis**
Now, compare your \`[Calculated Answer]\` with the provided \`options\` and \`correctAnswer\` from the input, and follow EXACTLY one of the three cases below. Do NOT mix them.

---
**Case A: The question is flawed (your calculated answer is not in the options).**

If your \`[Calculated Answer]\` is NOT present in the \`options\` array, then your response MUST be:
- \`textualExplanation\`: "The correct answer was not available in the options. We sincerely apologize for this mistake. The actual correct answer is [Your Calculated Answer]. We are improving this feature daily for a better experience."
- \`imageGenerationInstruction\`: "NO_IMAGE_NEEDED"

Do NOT provide a step-by-step solution in this case. Only provide the apology and the correct answer.

---
**Case B: The question is valid, but the system's provided \`correctAnswer\` was wrong.**

If your \`[Calculated Answer]\` IS present in the \`options\` array, but it is DIFFERENT from the provided \`correctAnswer\` input field:
- \`textualExplanation\`: Start with this exact phrase: "It appears there was an error in our system's designated answer. The true correct answer is '[Your Calculated Answer]'! We apologize for the confusion." Then, if the user's selected answer was correct (i.e., it matches your \`[Calculated Answer]\`), add "Congratulations, your answer was right!" After that, provide the full, step-by-step explanation of how to arrive at your \`[Calculated Answer]\`.
- \`imageGenerationInstruction\`: You MAY generate an image if it helps the explanation. If not, use "NO_IMAGE_NEEDED".

---
**Case C: Standard Explanation (The question and provided answer are correct).**

If your \`[Calculated Answer]\` is the SAME as the provided \`correctAnswer\` input field:
- \`textualExplanation\`: Provide a clear, step-by-step textual explanation for why the \`correctAnswer\` is correct. If the user's answer was wrong, tailor the explanation to be helpful. If the user's answer was correct, start with "Correct! Here's how we solve it:".
- \`imageGenerationInstruction\`: Follow the image generation rules based on the quiz difficulty.

---

**CRITICAL LANGUAGE INSTRUCTION:**
If the topic is "Hindi Literature", the entire 'textualExplanation' MUST be in Hindi (Devanagari script), regardless of the case. The 'imageGenerationInstruction' should remain in English.

**Image Generation Rules (for Case B and C):**
*   For "KVS Abki Baar 180 Paar!" and "NEET Abki Baar 720 Paar!" difficulties: It is HIGHLY ENCOURAGED to provide a helpful 'imageGenerationInstruction'.
*   For ALL OTHER difficulty levels: You MUST set the 'imageGenerationInstruction' field to "NO_IMAGE_NEEDED".

**Input Details for Your Analysis:**
Topic: {{{topic}}}
Difficulty: {{{difficulty}}}
Question: "{{{questionText}}}"
Options:
{{#each options}}
- {{{this}}}
{{/each}}
Original Correct Answer Provided to System: "{{{correctAnswer}}}"
User's Selected Answer: "{{{userSelectedAnswer}}}"

Now, begin your analysis and provide the output in the specified JSON format based on the cases above.
  `,config:{safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}});async function P(e){return z(e)}let z=s.defineFlow({name:"explainQuizAnswerFlow",inputSchema:M,outputSchema:k},async e=>{let t,{textualExplanation:o,imageGenerationInstruction:i}=(await R(e)).output;if(!o)throw Error("AI failed to generate a textual explanation.");if(["KVS Abki Baar 180 Paar!","NEET Abki Baar 720 Paar!"].includes(e.difficulty)&&i&&"NO_IMAGE_NEEDED"!==i.trim()&&""!==i.trim())try{console.log(`Attempting to generate image with prompt: "${i}" for special batch.`);let e=await s.generate({model:"googleai/gemini-2.0-flash-preview-image-generation",prompt:i,config:{responseModalities:["TEXT","IMAGE"],safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}});e.media&&e.media.url?(t=e.media.url,console.log("Image generated successfully.")):console.warn("Image generation was attempted but no image URL was returned. Image prompt was:",i,"Result:",e)}catch(e){console.error("Error during image generation for explanation:",e)}else console.log("No image generation needed (either not special batch, or instruction was 'NO_IMAGE_NEEDED').");return{explanationText:o,generatedImageUri:t}});(0,r.D)([P]),(0,i.A)(P,"4037be1a705f1b9594778ebc5e3ef4f58c7c6f7787",null);let D=a.z.object({questionText:a.z.string().describe("The text of the quiz question to be re-evaluated."),topic:a.z.string().describe("The topic of the quiz question."),difficulty:a.z.string().describe("The difficulty level of the quiz question."),currentOptions:a.z.array(a.z.string()).length(4).describe("The current list of options presented to the user.")}),L=a.z.object({options:a.z.array(a.z.string()).length(4).optional().describe("A new array of four unique answer options, if regeneration was needed."),correctAnswer:a.z.string().optional().describe("The re-calculated correct answer, if regeneration was needed."),message:a.z.string().optional().describe("A message to the user if the original options were correct.")});async function U(e){return F(e)}let B=a.z.object({regenerationNeeded:a.z.boolean().describe("Set to true if new options were generated. Set to false if not."),reasoning:a.z.string().describe("Brief reasoning for the decision. E.g., 'Correct answer was not in options.' or 'Options are valid.'"),messageForUser:a.z.string().describe("If regenerationNeeded is false, this field contains the message to show the user (e.g., 'Sorry, the options given are correct...'). If regenerationNeeded is true, this MUST be an empty string."),newOptions:a.z.array(a.z.string()).describe("If regenerationNeeded is true, this is the new array of four options. If false, this MUST be an empty array."),newCorrectAnswer:a.z.string().describe("If regenerationNeeded is true, this is the new correct answer. If false, this MUST be an empty string.")}),G=s.definePrompt({name:"regenerateQuizOptionsPrompt",input:{schema:D},output:{schema:B},prompt:`You are a meticulous quiz question validator and regenerator. Your task is to take an existing quiz question and its current options, re-solve the question from scratch to find the correct answer, and then determine if a regeneration is necessary.

**Step 1: Analyze and Re-Solve the Question**
1.  Analyze the following question text carefully.
2.  Independently solve it to determine the correct answer. Let's call this your \`[Calculated Answer]\`.
3.  If the question is fundamentally flawed, ambiguous, or unsolvable, note this down.

**Question Details:**
Topic: {{{topic}}}
Difficulty: {{{difficulty}}}
Question Text: "{{{questionText}}}"
Current Options: {{#each currentOptions}}
- {{{this}}}
{{/each}}


**Step 2: Validate and Respond**
Now, based on your analysis, you MUST populate all fields of the required JSON output structure. Follow EXACTLY one of the three cases below for how to fill the fields.

---
**Case A: The question is flawed or unsolvable.**
If you determine that the question itself is ambiguous, contains a typo, or is impossible to answer, you MUST respond with:
- \`regenerationNeeded\`: false
- \`reasoning\`: "The question is flawed and cannot be solved."
- \`messageForUser\`: "Sorry, the question appears to be flawed, which is why a correct answer wasn't available. We have noted this for review."
- \`newOptions\`: [] (an empty array)
- \`newCorrectAnswer\`: "" (an empty string)

---
**Case B: The correct answer IS ALREADY in the options.**
If the question is valid and your \`[Calculated Answer]\` IS found within the \`currentOptions\` array, you MUST respond with:
- \`regenerationNeeded\`: false
- \`reasoning\`: "The calculated answer is already present in the current options."
- \`messageForUser\`: "Sorry but the options given are correct. If you have any doubt with the question, you can ask the HPS AI Assistant for an explanation."
- \`newOptions\`: [] (an empty array)
- \`newCorrectAnswer\`: "" (an empty string)

---
**Case C: The correct answer IS NOT in the options (Regeneration needed).**
If the question is valid and your \`[Calculated Answer]\` is NOT found within the \`currentOptions\` array, then you MUST generate a new set of options and respond with:
- \`regenerationNeeded\`: true
- \`reasoning\`: "The calculated correct answer was not in the original options."
- \`messageForUser\`: "" (an empty string)
- \`newOptions\`: A new array of **exactly four** plausible options, one of which **MUST** be your \`[Calculated Answer]\`.
- \`newCorrectAnswer\`: Your \`[Calculated Answer]\`. This **MUST** exactly match one of the strings in the \`newOptions\` array.

---

**CRITICAL INSTRUCTION:**
You MUST ALWAYS return a JSON object with all five fields: \`regenerationNeeded\`, \`reasoning\`, \`messageForUser\`, \`newOptions\`, and \`newCorrectAnswer\`. Do not omit any fields. Populate them according to the cases described above.

Output the result in the specified JSON format.
  `,config:{safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}}),F=s.defineFlow({name:"regenerateQuizOptionsFlow",inputSchema:D,outputSchema:L},async e=>{let{output:t}=await G(e);if(!t)throw Error("AI failed to generate a response for option regeneration.");if(t.regenerationNeeded){if(!t.newOptions||4!==t.newOptions.length)throw Error(`AI regenerated an invalid number of options (${t.newOptions?.length||0}). Expected 4.`);if(!t.newCorrectAnswer||!t.newOptions.includes(t.newCorrectAnswer))throw Error(`AI regenerated a correct answer ("${t.newCorrectAnswer}") that is not present in the new options list.`);return{options:t.newOptions,correctAnswer:t.newCorrectAnswer}}if(!t.messageForUser)throw Error("AI indicated no regeneration was needed but failed to provide a message for the user.");return{message:t.messageForUser}});(0,r.D)([U]),(0,i.A)(U,"40f2a0fa4df54e99d6226bcfc262a9f33dc39e729e",null);let H=a.z.object({classLevel:a.z.string().describe('The class level (e.g., "Class 9", "LKG", "Class 12").'),subject:a.z.string().describe('The subject (e.g., "Mathematics", "Science", "English").'),chapterInfo:a.z.string().describe('The chapter name and/or number (e.g., "Chapter 1: Matter in Our Surroundings").'),userQuestion:a.z.string().optional().describe("A specific question the teacher wants an answer to. If empty, the AI will suggest questions and answers.")}),Y=a.z.object({generatedContent:a.z.string().describe("The AI-generated answer to the teacher's question, or a list of suggested NCERT-based questions and answers for the specified chapter. If suggesting questions, format them clearly with questions and their corresponding answers.")});async function Q(e){return K(e)}let j=s.definePrompt({name:"teacherConduitPrompt",input:{schema:H},output:{schema:Y},prompt:`You are an expert educational assistant specializing in the NCERT curriculum for Indian schools. You are interacting with a teacher who needs assistance.

Class: {{{classLevel}}}
Subject: {{{subject}}}
Chapter: {{{chapterInfo}}}

Your task is to provide educational material based on the NCERT syllabus for the given parameters. Ensure all answers are appropriate for the specified "{{classLevel}}", using language and depth suitable for students at that level.

{{#if userQuestion}}
The teacher has asked the following specific question:
"{{{userQuestion}}}"

Please provide a clear, concise, and accurate answer to this question. The answer should be comprehensive enough for a teacher to use for explanations or to derive teaching points. Ensure the answer is strictly based on NCERT content and appropriate for the specified class, subject, and chapter.
{{else}}
The teacher has not asked a specific question. In this case, please generate 3-5 relevant NCERT-based questions that a teacher could ask their students for the specified class, subject, and chapter. For each question, also provide a detailed and accurate NCERT-based answer.

**IMPORTANT FORMATTING FOR SUGGESTED Q&A:**
Present the questions and answers as a single block of **plain text**. DO NOT use JSON, markdown lists, or any array structures in the output. Each question MUST start with "Question X:" (e.g., "Question 1:", "Question 2:") and its corresponding answer MUST start with "Answer X:" (e.g., "Answer 1:", "Answer 2:"). Each question and its answer should be clearly separated. Ensure the complexity and depth of the answers are appropriate for the "{{classLevel}}".

For example (ensure actual content is NCERT based and class-appropriate):
Question 1: What is matter? Give some examples.
Answer 1: Matter is anything that has mass and takes up space. For {{classLevel}}, some examples are a book, water, air, and a pencil.

Question 2: What are the states of matter?
Answer 2: For {{classLevel}}, the main states of matter are solid (like ice), liquid (like water), and gas (like air). Solids have a fixed shape, liquids take the shape of their container, and gases spread out to fill any space.

...and so on for 3 to 5 questions.
{{/if}}

Ensure all information provided is accurate and aligns with the NCERT curriculum and the student's class level.
  `,config:{safetySettings:[{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]}}),K=s.defineFlow({name:"teacherConduitFlow",inputSchema:H,outputSchema:Y},async e=>{let{output:t}=await j(e);if(!t)throw Error("AI failed to generate educational content.");return t});async function V(e){return h(e)}async function X(e){return b(e)}async function J(e){return E(e)}async function W(e){return x(e)}async function $(e){return P(e)}async function Z(e){return U(e)}async function ee(e){return Q(e)}(0,r.D)([Q]),(0,i.A)(Q,"401d51153f0e21f15e7430e12651994f78ee18b085",null),(0,r.D)([V,X,J,W,$,Z,ee]),(0,i.A)(V,"401db5a6cd2799d23e68391e645e29759a1a93ef82",null),(0,i.A)(X,"40bc51f6f1080cd486580ba57b2724c7228377cce5",null),(0,i.A)(J,"408f8cab30e4235790abf276ed48a7b5af76deaef3",null),(0,i.A)(W,"4016dfb1b53aaf72ad99a394be5589a99d3e8d096a",null),(0,i.A)($,"406d23d8c146bbdca59d7655a9037e60c6bd6cd672",null),(0,i.A)(Z,"403c07a2665152dea88db61e925969b288ce8d195a",null),(0,i.A)(ee,"40d488b7c69c749750742c6d3f170fdad6a2da8e61",null)},70440:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>a});var i=o(31658);let a=async e=>[{type:"image/x-icon",sizes:"66x72",url:(0,i.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};